
# Table of Contents

1.  [Проверка на брейкпоинты и временный код.](#org8b92c77)
2.  [Контроль тестирования\\сборки](#orgbd7eda9)
    1.  [Сборка](#org520551b)
3.  [Вставка имени ветки в сообщение коммита](#orgff0c0a1)
4.  [Настройка и добавление хуков в репы](#org7ea02ef)
    1.  [Понять, а можно ли этот файл использовать, как подключаемый.](#org56d4f62)
    2.  [Бонус для емаксеров](#orgda8f9b7)

Шаблоны git-хуков, облегчающие трудовыебудни.

И немного поднимающие настроение. Чтобы завести своего гитотамагочи,
установите `cowsay` и наслаждайтесь. А нет, так выпилите. Это ж
шаблон, в конце концов.


<a id="org8b92c77"></a>

# Проверка на брейкпоинты и временный код.

Помечать временный код &#x2013; хорошее решение. Помечайте временный
код. Называйте специфично временные переменные, или добавляйте
соответствующий комментарий. Я, например, для помечания временного кода
использую слово `Petuch` в данных, комментариях или как имя
временной переменной, используемой для отладки.
Хук отлавливает помеченный временный код, забытые бряки гнутых
дебаггеров и прерывает коммит при их нахождении.

    REJECT_MESSAGE=$($GETTEXT "COMMIT REJECTED: Код содержит брейкпоинты или помеченные временные конструкции. Удалите их перед коммитом!")
    CLEAR_STATUS_MESSAGE=$($GETTEXT "Код не содержит бряков и временного кода")
    tc_check=$(git grep -i "$REGXP_TC" -- "$F_MASK")
    if [ ${#tc_check} -gt 0 ]
    then
            echo -e $tc_check "\e[31m$REJECT_MESSAGE\e[0m" | cowsay -f dragon
            echo -e $tc_check 
            exit 1
    else
            echo -e $tc_check "\e[36m$CLEAR_STATUS_MESSAGE\e[0m" | cowsay
            echo -e $tc_check 
    fi


<a id="orgbd7eda9"></a>

# Контроль тестирования\\сборки

Перед коммитов выполняется команда на контроль качества. Прогон
тестов, сборка.

    TEST_PASSED=$($GETTEXT "\e[36mТесты пройдены успешно\e[0m")
    TEST_FAILED=$($GETTEXT "
    \e[31mCOMMIT REJECTED: Тесты сломаны! 
    Убедитесь, что программа работает корректно и повторите попытку.\e[0m
    Если подозреваете, что в поломке виноват кто-то другой (или молодой вы), 
    воспльзуйтесь командой\n
    \tgit bisect
    ")
    $QCONTROL_COMMAND
    RESULT=$?
    if [ $RESULT -ne 0 ]
    then
        echo -e $TEST_FAILED | cowsay -f dragon
        exit 1
    else
        echo -e $TEST_PASSED | cowsay 
    fi


<a id="org520551b"></a>

## Сборка

В блок кода ниже вставить имена чанков в noweb-синтаксисе и
выполнить `org-babel-tangle` (по-умолчанию `C-c C-v t`)

    #!/bin/bash
    {{{l10n}}}
    REGXP_TC="; Tracer()()\|.set_trace()\|petuch"
    F_MASK="*.py"
    QCONTROL_COMMAND="./manage.py test"
    {{{Проверка на наличие нежелательного\временного кода}}}
    {{{тесты перед коммитом}}}
    exit 0


<a id="orgff0c0a1"></a>

# Вставка имени ветки в сообщение коммита

Всякие ЖИРО-образные системы любят, чтобы в сообщении коммита
писались имена задач, чтобы их можно было вставлять в историю
задач. И чтобы еще и ветки так же назывались. 
По жиротрадиции, это что-то вроде FOO-1337.

    #!/bin/bash 
    BRANCH_NAME=$(git rev-parse --abbrev-ref HEAD | grep "[[:upper:]].*-[[:digit:]].*")
    echo "$BRANCH_NAME" >> $1


<a id="org7ea02ef"></a>

# Настройка и добавление хуков в репы

При работе с литературным исходником можно выполнить настройку и
сборку непосредственно из самого Emacs. Подробнее &#x2013; в литературном
исходнике. 


<a id="org56d4f62"></a>

## TODO Понять, а можно ли этот файл использовать, как подключаемый.

Тогда сетап для хуков можно будет хранить в отдельном орг-файле, и
этот полиморфный уебок не будет себя вести, как школьница. 
Сетап в таблице, выполнение из кастомных файлов. Красота!
А хули мне, собственно, стоит?

    #+TITLE: Пример гит-хуков для проектов
    #+AUTHOR: Roman Zayrullin
    #+EMAIL: krosenmann@gmail.com
    #+STARTUP: showall
    #+INCLUDE: "./programm.org"
    
    * На стройку!
    #+tblname: awesome_django_setup
    | Имя параметра    | значение                                       |
    |------------------+------------------------------------------------|
    | REGXP_TC         | "; Tracer()()\\vert.set_trace()\\vert\ petuch" |
    | F_MASK           | "*.py"                                         |
    | QCONTROL_COMMAND | "./manage.py test"                             |
    | PROJECT          | "/home/roman/sources/learning-some-shit/"      |
    |------------------+------------------------------------------------|
    
    Возможное решение -- повернуть таблицу так, чтобы на одной строке
    находились параметры одного проекта, тогда можно будет применить
    табличную функцию, которая совершит весь нехитрый сетап!
    
    #+begin_src python :var keys=awesome_django_setup :results output table :colnames no
    print(keys)
    #+end_src
    
    #+RESULTS:
    | Имя параметра    | значение                                 |
    | REGXP_TC         | ; Tracer()()\vert.set_trace()\vertpetuch |
    | F_MASK           | *.py                                     |
    | QCONTROL_COMMAND | ./manage.py test                         |
    | PROJECT          | /home/roman/sources/learning-some-shit/  |


<a id="orgda8f9b7"></a>

## Бонус для емаксеров

-   Настройка
    1.  Задать значения для переменных
    2.  Вставить чанки интересующих хуков `{{{<имя чанка>}}}`
    3.  Выполнить `C-c C-v t`
-   Установка
    1.  Перейти в чанк "установка"
    2.  В хедере чанка, в переменной PROJECT, задать путь до проекта
    3.  В чанке "установка" выполнить `C-c C-c`

