#+TITLE: Git Hooks Collection
#+AUTHOR: Roman Zayrullin
#+EMAIL: krosenmann@gmail.com
#+EXPORT_FILE_NAME: README
#+STARTUP: showall
#+LaTeX_ClASS_OPTIONS: [11pt,a4paper,ubuntu]
#+LaTeX_HEADER:\usepackage[scale=0.75]{geometry}
#+LaTeX_HEADER:\usepackage[utf-8]{inputrec}

–•—É–∫–∏, –æ–±–ª–µ–≥—á–∞—é—â–∏–µ —Ç—Ä—É–¥–æ–≤—ã–µ–±—É–¥–Ω–∏.
#+name: l10n
#+begin_src shell :export no
  GETTEXT='gettext "kr-githooks"'
#+end_src

#+RESULTS: l10n

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±—Ä–µ–π–∫–ø–æ–∏–Ω—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–¥.
  –ü–æ–º–µ—á–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–¥ -- —Ö–æ—Ä–æ—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ. –ü–æ–º–µ—á–∞–π—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–π
  –∫–æ–¥. –ù–∞–∑—ã–≤–∞–π—Ç–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∏–ª–∏ –¥–æ–±–∞–≤–ª—è–π—Ç–µ
  —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π. –Ø, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –ø–æ–º–µ—á–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
  –∏—Å–ø–æ–ª—å–∑—É—é —Å–ª–æ–≤–æ ~Petuch~ –≤ –¥–∞–Ω–Ω—ã—Ö, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –∏–ª–∏ –∫–∞–∫ –∏–º—è
  –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.
  –•—É–∫ –æ—Ç–ª–∞–≤–ª–∏–≤–∞–µ—Ç –ø–æ–º–µ—á–µ–Ω–Ω—ã–π –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–¥, –∑–∞–±—ã—Ç—ã–µ –±—Ä—è–∫–∏ –≥–Ω—É—Ç—ã—Ö
  –¥–µ–±–∞–≥–≥–µ—Ä–æ–≤ –∏ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç –∫–æ–º–º–∏—Ç –ø—Ä–∏ –∏—Ö –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–∏.
#+NAME: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ–≥–æ\–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
#+HEADER: :var REGXP_TC="; Tracer()()\\|.set_trace()\\|petuch" :var F_MASK="*.py"
#+BEGIN_SRC shell :noweb no-export
  REJECT_MESSAGE=$($GETTEXT "COMMIT REJECTED: commit contains code with break points. Please remove before commiting.")
  CLEAR_STATUS_MESSAGE=$($GETTEXT "Code contains no break points")
  tc_check=$(git grep -i "$REGXP_TC" -- "$F_MASK")
  if [ ${#tc_check} -gt 0 ]
  then
          echo -e $tc_check "\e[31m$REJECT_MESSAGE\e[0m" | cowsay -f dragon
          exit 1
  else
          echo -e $tc_check "\e[36m$CLEAR_STATUS_MESSAGE\e[0m" | cowsay
  fi
#+end_src

#+RESULTS: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ–≥–æ\–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
: [36mCode contains no break points[0m

* –ö–æ–Ω—Ç—Ä–æ–ª—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\—Å–±–æ—Ä–∫–∏
–ü–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞. –ü—Ä–æ–≥–æ–Ω
—Ç–µ—Å—Ç–æ–≤, —Å–±–æ—Ä–∫–∞.

#+NAME: —Ç–µ—Å—Ç—ã –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
#+header: :var QCONTROL_COMMAND="./manage.py test"
#+begin_src shell :noweb no-export 
  TEST_PASSED=$($GETTEXT "\e[36mAll Test Passed\e[0m")
  TEST_FAILED=$($GETTEXT "\e[31mCOMMIT REJECTED: Test's failed!\e[0m")
  $QCONTROL_COMMAND
  RESULT=$?
  if [ $RESULT -ne 0 ]
  then
      echo -e $TEST_FAILED | cowsay -f dragon
      exit 1
  else
      echo -e $TEST_PASSED | cowsay 
  fi
#+end_src

#+RESULTS: —Ç–µ—Å—Ç—ã –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

** –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Å–±–æ—Ä–∫–∞
  
   –í –±–ª–æ–∫ –∫–æ–¥–∞ –Ω–∏–∂–µ –≤—Å—Ç–∞–≤–∏—Ç—å –∏–º–µ–Ω–∞ —á–∞–Ω–∫–æ–≤ –≤ noweb-—Å–∏–Ω—Ç–∞–∫—Å–∏—Å–µ –∏
   –≤—ã–ø–æ–ª–Ω–∏—Ç—å ~org-babel-tangle~ (–ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é ~C-c C-v t~)
   #+NAME: precommit-django-exmpl
   #+BEGIN_SRC shell :tangle pre-commit :noweb no-export
     #!/bin/bash
     {{{l10n}}}
     REGXP_TC="; Tracer()()\|.set_trace()\|petuch"
     F_MASK="*.py"
     QCONTROL_COMMAND="./manage.py test"
     {{{–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ–≥–æ\–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞}}}
     {{{—Ç–µ—Å—Ç—ã –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º}}}
     exit 0
   #+END_SRC

   #+RESULTS: precommit-django-exmpl

* –í—Å—Ç–∞–≤–∫–∞ –∏–º–µ–Ω–∏ –≤–µ—Ç–∫–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞
  –í—Å—è–∫–∏–µ –ñ–ò–†–û-–æ–±—Ä–∞–∑–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –ª—é–±—è—Ç, —á—Ç–æ–±—ã –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –∫–æ–º–º–∏—Ç–∞
  –ø–∏—Å–∞–ª–∏—Å—å –∏–º–µ–Ω–∞ –∑–∞–¥–∞—á, —á—Ç–æ–±—ã –∏—Ö –º–æ–∂–Ω–æ –±—ã–ª–æ –≤—Å—Ç–∞–≤–ª—è—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é
  –∑–∞–¥–∞—á. –ò —á—Ç–æ–±—ã –µ—â–µ –∏ –≤–µ—Ç–∫–∏ —Ç–∞–∫ –∂–µ –Ω–∞–∑—ã–≤–∞–ª–∏—Å—å. 
  –ü–æ –∂–∏—Ä–æ—Ç—Ä–∞–¥–∏—Ü–∏–∏, —ç—Ç–æ —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ FOO-1337.
  #+name: –ò–º—è –≤–µ—Ç–∫–∏ –≤ –Ω–∞—á–∞–ª–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–æ–º–º–∏—Ç–∞
  #+begin_src shell :noweb no-export :tangle prepare-commit-msg
    #!/bin/bash 
    BRANCH_NAME=$(git rev-parse --abbrev-ref HEAD | grep "[[:upper:]].*-[[:digit:]].*")
    echo "$BRANCH_NAME" >> $1
  #+end_src

  #+RESULTS: –ò–º—è –≤–µ—Ç–∫–∏ –≤ –Ω–∞—á–∞–ª–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–æ–º–º–∏—Ç–∞

* –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ö—É–∫–æ–≤ –≤ —Ä–µ–ø—ã
   –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–º –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–º –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∏
   —Å–±–æ—Ä–∫—É –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –∏–∑ —Å–∞–º–æ–≥–æ Emacs. –ü–æ–¥—Ä–æ–±–Ω–µ–µ -- –≤ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–º
   –∏—Å—Ö–æ–¥–Ω–∏–∫–µ. 
** –ë–æ–Ω—É—Å –¥–ª—è –µ–º–∞–∫—Å–µ—Ä–æ–≤                                             :noexport:
   * –ù–∞—Å—Ç—Ä–æ–π–∫–∞
     1. –ó–∞–¥–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
     2. –í—Å—Ç–∞–≤–∏—Ç—å —á–∞–Ω–∫–∏ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏—Ö —Ö—É–∫–æ–≤ ~{{{<–∏–º—è —á–∞–Ω–∫–∞>}}}~
     3. –í—ã–ø–æ–ª–Ω–∏—Ç—å ~C-c C-v t~
   * –£—Å—Ç–∞–Ω–æ–≤–∫–∞
     1. –ü–µ—Ä–µ–π—Ç–∏ –≤ —á–∞–Ω–∫ "—É—Å—Ç–∞–Ω–æ–≤–∫–∞"
     2. –í —Ö–µ–¥–µ—Ä–µ —á–∞–Ω–∫–∞, –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π PROJECT, –∑–∞–¥–∞—Ç—å –ø—É—Ç—å –¥–æ –ø—Ä–æ–µ–∫—Ç–∞
     3. –í —á–∞–Ω–∫–µ "—É—Å—Ç–∞–Ω–æ–≤–∫–∞" –≤—ã–ø–æ–ª–Ω–∏—Ç—å ~C-c C-c~

   #+NAME: —É—Å—Ç–∞–Ω–æ–≤–∫–∞
   #+BEGIN_SRC shell :tangle no :var PROJECT="" :export no
     REPO=$PROJECT/.git/hooks/
     chmod +x pre-commit 
     chmod +x prepare-commit-msg
     cp pre-commit -t $REPO
     cp prepare-commit-msg $REPO
   #+END_SRC

   #+RESULTS:

* File-local variables                                             :noexport:  
  # Local Variables:
  # org-babel-noweb-wrap-start: "{{{"
  # org-babel-noweb-wrap-end: "}}}"
  # org-confirm-babel-evaluate: nil
  # org-export-allow-bind-keywords: t
  # End:
