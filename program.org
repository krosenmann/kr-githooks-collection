#+TITLE: Git Hooks Collection
#+AUTHOR: Roman Zayrullin
#+EMAIL: krosenmann@gmail.com
#+STARTUP: showall
#+LaTeX_ClASS_OPTIONS: [11pt,a4paper,ubuntu]
#+LaTeX_HEADER:\usepackage[scale=0.75]{geometry}
#+LaTeX_HEADER:\usepackage[utf-8]{inputrec}

Проверка на брейкпоинты и временные переменные. А если точнее, то на
любые нежелательные куски временного кода, которые могут быть
отобранны по регулярке, понимаемой git-grep.
#+NAME: Проверка на наличие нежелательного\временного кода
#+BEGIN_SRC shell :export no
#!/bin/bash

pdb_check=$(git grep -i ';Tracer()()\|.set_trace()\|petuch' -- '*.py')

if [ ${#pdb_check} -gt 0 ]
then
        echo -e "\e[31mCOMMIT REJECTED: commit contains code with break points. Please remove before commiting.\e[0m"
        echo $pdb_check
        exit 1
else
        echo -e "\e[36mCode contains no break points\e[0m"
fi
#+end_src

#+name: 
#+begin_src shell :noweb yes :export results
  echo "print('подопытный файл')\nfrom IPython.core.debugger import Tracer; Tracer()()\n" > rabb.py

  <<Проверка на наличие нежелательного\временного кода>>
#+end_src
Тестирование джанго-проектов
#+NAME: commit_after_tests
#+begin_src shell
source .venv/bin/activate
./manage.py test
RESULT=$?
if [ $RESULT -ne 0 ]
then
    echo -e "\e[31mCOMMIT REJECTED: Test's failed!\e[0m"
    exit 1
else
    echo -e "\e[36mTest Passed\e[0m"
fi

exit 0
#+end_src
* Интерактивная сборка
  В блок кода ниже вставить имена чанков в noweb-синтаксисе и
  выполнить ~org-babel-tanle~ (по-умолчанию ~C-c C-v t~)
  #+BEGIN_SRC shell :tanle pre-commit
    <<check_bps>>
  #+END_SRC
